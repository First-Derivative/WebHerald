{% load static %}

<!-- Comments -->
<div class="row border my-3 p-3 w-100" id="comments_section">

  <div class="p-2 w-100" >
    <h2>Comments</h2>

    <!-- Comment post form -->
    <div class="post_comment pt-3 w-auto" id="comment_post_wrapper">
      {% if request.user.is_authenticated %}
      <form id="new_comment_form">
        <div class="form-group" >
          <textarea name="comment" class="form-control" rows="3" placeholder="Join the conversation..."></textarea>
        </div>
        <button type="submit" class="btn btn-dark">Post your comment</button>
      </form>
      {% else %}
        <div>
          <p>Please <a href="{% url 'login' %}">log in</a> to your account to join the debate!</p>
        </div>
      {% endif %}
    </div>

    <hr>

    <!-- Display comments -->
    <div class="media mt-5" id="comments_display">

      <div class="media-body ml-4">

        {% if article_comments %}

          {% for comment in article_comments %}

              <!-- PARENT COMMENT -->
              <div class="media parent_comment_wrapper">
                <img src="{% static 'images/profile_pictures/empty-profile.jpg' %}" class="mr-3" alt="..." width="64px" height="64px">

                <div class="media-body  parent_comment">
                  <div class="comment_header mt-0 mb-2">
                    <h5 class="mr-3 mb-0">{{comment.user.username}}</h5>
                    <small class="serif"> commented on: {{comment.timestamp}}</small>

                  </div>

                  <p class="comment_content">{{comment.content}}</p>
                  <button type="button" class="btn btn-dark comment_reply_btn">Reply</button>
                </div>

              </div>

              {% for child_comment in comment.child_comments.all %}
                <!--  CHILD COMMENTS  -->
                <div class="media mb-5 child_comment_wrapper">
                <img src="{% static 'images/profile_pictures/empty-profile.jpg' %}" class="mr-3" alt="..." width="64px" height="64px">

                  <div class="media-body child_comment">
                    <div class="comment_header mt-0 mb-2">
                      <h5 class="mr-3 mb-0">{{child_comment.user.username}}</h5>
                      <small class="serif"> commented on: {{child_comment.timestamp}}</small>
                    </div>

                    <p class="comment_content">{{child_comment.content}}</p>
                    <button type="button" class="btn btn-dark comment_reply_btn">Reply</button>
                  </div>

                </div>
              {% endfor %}
          {% endfor %}

        {% else %}

          <div class="ml-3 pb-5" >
            <h4>No comments yet! Be the first.</h4>
          </div>

        {% endif%}

      </div>

    </div>
  </div>

</div>
